<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.farm.service.IProductService">
	<insert id="productWrite" parameterType="com.farm.dto.ProductDTO">
		<selectKey keyProperty="prod_id" resultType="long" order="BEFORE">
			SELECT seq_product_id.nextval FROM dual
		</selectKey>
	
		INSERT INTO product
			(prod_price, prod_stock, member_id, prod_id, prod_cate, prod_content, prod_name	) 
		VALUES
			(#{prod_price}, #{prod_stock}, #{member_id}, #{prod_id}, #{prod_cate}, #{prod_content}, #{prod_name})
	</insert>
	
	<select id="getTotalCount" 
		resultType="int"
		parameterType="com.farm.dto.ParameterDTO">
		
		SELECT COUNT(*) FROM product
		
		<!-- 검색어가 있는 경우에만 where절을 조건부로 추가한다. -->
		<if test="searchWord!=null and 
			!searchWord.equals('')">
		WHERE puduct_name LIKE '%' || #{searchWord} || '%'	
		</if>
	</select>
	
	
	
	<select id="selectProduct"
		parameterType="com.farm.dto.ParameterDTO"
		resultType="com.farm.dto.ProductDTO">
		SELECT prod_price, prod_stock, member_id, prod_id, prod_cate, prod_content, prod_name
		FROM (SELECT Tb.*, rownum rNum FROM (
				SELECT * FROM product
				<if test="searchWords != null and !searchWords.equals('') ">
					WHERE 
					<foreach collection="searchWords" item="sw" 
						separator="or" open="(" close=")">
					prod_name LIKE '%' || #{sw} || '%'
					</foreach>
				</if>
				ORDER BY prod_id DESC
			) Tb
			WHERE rownum<![CDATA[<=]]>#{end}
		)
		WHERE rNum <![CDATA[>=]]>#{start}
	</select>
	
	<select id="selectProductView"
		parameterType="com.farm.dto.ProductDTO"
		resultType="com.farm.dto.ProductDTO">
		SELECT prod_price, prod_stock, member_id, prod_id, prod_cate, prod_content, prod_name
		FROM product
		WHERE prod_id = #{prod_id}
	</select>
	
	<update id="updateProduct"
		parameterType="com.farm.dto.ProductDTO">
		UPDATE product set(
			prod_price = #{prod_price}, 
			prod_stock = #{prod_stock},  
			prod_cate = #{prod_cate}, 
			prod_content = #{prod_content}, 
			prod_name = #{prod_name}
		)
		WHERE prod_id = #{prod_id}
	</update>
	
	<delete id="deleteProduct"
		parameterType="com.farm.dto.ProductDTO">
		DELETE FROM product WHERE prod_id = #{prod_id}
	</delete>

	
</mapper>
   