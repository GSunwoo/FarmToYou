<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.farm.service.IInquiryService">
   <!-- 문의 조회 -->
    <select id="getTotalCount1"
    parameterType="com.farm.dto.InquiryDTO">
    SELECT COUNT(*) FROM inquiry
    	WHERE member_id = #{member_id}
    </select>
    <select id="getTotalCount2"
    >
	SELECT COUNT(inq.inquiry_id) AS inquiry_count
		FROM inquiry inq
		LEFT JOIN product pro
		  ON inq.prod_id = pro.prod_id
			WHERE pro.member_id = #{member_id}
    </select>
    
   
   <select id="selectInq1"
   parameterType="com.farm.dto.PageDTO"
   resultType="com.farm.dto.InquiryDTO"
   >
   SELECT inquiry_id, prod_id, content, member_id, title, postdate AS postdate
         FROM inquiry 
         WHERE member_id = #{member_id} ORDER BY postdate DESC
   </select>
   
   <select id="selectInq2"
   parameterType="Long"
   resultType="com.farm.dto.InquiryDTO"
   >
   SELECT inq.inquiry_id, inq.prod_id, inq.content, inq.member_id, title, postdate AS postdate
         FROM inquiry inq
         INNER JOIN product pro ON inq.prod_id = pro.prod_id
         WHERE pro.member_id = #{member_id} 
         ORDER BY postdate DESC
   </select>
   <!-- 조인걸어서 가야돼 멤버 -->
   <!-- 문의 등록 -->
   <insert id="insertInq"
      parameterType="com.farm.dto.InquiryDTO">
      INSERT INTO inquiry
         (inquiry_id, prod_id, user_id, content, title, member_id)   
      VALUES
         (seq_inquiry_id.nextval, #{prod_id} ,#{user_id} , #{content} ,#{title}, #{member_id})
   </insert>
   
   <!-- 문의 수정 -->
   <update id="updateInquiry"
      parameterType="com.farm.dto.InquiryDTO">
      UPDATE inquiry 
         SET title = #{title}, content = #{content}
            WHERE inquiry_id = #{inquiry_id}
   </update>
   
   <!-- 문의 삭제 -->
   <delete id="deleteInquiry"
      parameterType="Long">
      DELETE FROM inquiry WHERE inquiry_id = #{inquiry_id} AND member_id= #{member_id}
   </delete>
   
   <!-- mapper/inquiryDAO.xml (namespace는 그대로) -->
<select id="inquiryDetail"
        parameterType="com.farm.dto.InquiryDTO"
        resultType="com.farm.dto.InquiryDTO">
  SELECT inquiry_id, inquiry.prod_id, content, inquiry.member_id, title, postdate, prod_name, user_id
  FROM inquiry
  LEFT JOIN product
  	ON inquiry.prod_id=product.prod_id
  LEFT JOIN member
  	ON inquiry.member_id=member.member_id
  WHERE inquiry_id = #{inquiry_id}
    AND inquiry.member_id  = #{member_id}   <!-- 본인 글만 열람하려면 유지, 아니면 제거 -->
</select>
   
   	<select id="selectProd_id" parameterType="Long"
   		resultType="Long">
   		SELECT prod_id FROM inquiry
   		WHERE inquiry_id = #{inquiry_id}
   	</select>
   
   
</mapper>