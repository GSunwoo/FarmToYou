<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.farm.service.IMypageService">
	<!--             구매자용 DAO                   -->
	<!-- 해당 멤버의 결제완료된 구매건수 -->
	<select id="getOrderCnt"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase 
			WHERE 
				member_id = #{member_id} AND
				purc_cmpl = 1
	</select>
	<!-- 해당 멤버가 작성한 리뷰 수 -->
	<select id="getReviewCnt"
		resultType="int">
		SELECT COUNT(*)
			FROM review 
			WHERE 
				member_id = #{member_id}
	</select>
	<!-- 해당 멤버가 작성한 문의 수 -->
	<select id="getInquiryCnt"
		resultType="int">
		SELECT COUNT(*)
			FROM inquiry 
			WHERE 
				member_id = #{member_id}
	</select>
	
	<!--             판매자용 DAO                   -->
	<!-- 주문확인중인 주문수 -->
	<select id="getCheckOrder"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase
			INNER JOIN product
				ON purchase.prod_id=product.prod_id
			INNER JOIN member
				ON product.member_id=member.member_id
			WHERE 
				member_id = #{member_id} AND
				purc_state = 'chk_order'
	</select>
	<!-- 상품준비중인 주문수 -->
	<select id="getPrepareOrder"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase
			INNER JOIN product
				ON purchase.prod_id=product.prod_id
			INNER JOIN member
				ON product.member_id=member.member_id
			WHERE 
				member_id = #{member_id} AND
				purc_state = 'prepare_order'
	</select>
	<!-- 배송중인 주문수 -->
	<select id="getDeliOrder"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase
			INNER JOIN product
				ON purchase.prod_id=product.prod_id
			INNER JOIN member
				ON product.member_id=member.member_id
			WHERE 
				member_id = #{member_id} AND
				purc_state = 'deli_order'
	</select>
	<!-- 배송완료된 주문수 -->
	<select id="getCompleteOrder"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase
			INNER JOIN product
				ON purchase.prod_id=product.prod_id
			INNER JOIN member
				ON product.member_id=member.member_id
			WHERE 
				member_id = #{member_id} AND
				purc_state = 'cmpl_order'
	</select>
	<!-- 판매자에게 들어온 문의수 -->
	<select id="getInquiryCnt_Seller"
		resultType="int">
		SELECT COUNT(*)
			FROM inquiry 
			INNER JOIN product
				ON inquiry.prod_id=product.prod_id
			INNER JOIN member
				ON product.member_id=member.member_id
			WHERE member_id=${member_id}
	</select>
	
	<select id="getSoldNum"
		resultType="int">
		SELECT COUNT(*)
			FROM purchase
			INNER JOIN product pr
				ON pu.prod_id=pr.prod_id
			WHERE pr.member_id=${member_id} AND
				pu.purc_date BETWEEN #{start_date} AND #{end_date}
	</select>
	
	<select id="getSales"
		resultType="int">
		SELECT SUM(pr.prod_price)
			FROM purchase pu
			INNER JOIN product pr
				ON pu.prod_id=pr.prod_id
			WHERE pr.member_id=#{member_id} AND
				pu.purc_date BETWEEN #{start_date} AND #{end_date}
	</select>
</mapper>
